\chapter{Steiner Trees in Graphs}
\label{chap:steiner-trees}

\section{Steiner Tree Problem}
The Steiner Tree Problem (STP) is defined as follows.
Given an undirected graph
$$G = (V, E, c)$$
 where $c: E \to \RR^+$ defines edge weights, and additionally a set of terminals $N \subseteq V$ then
a Steiner Tree is a tree, $T = (V_T, E_T, c) \subseteq G$, which spans $N$ with minimal cost. We denote vertices which must be part of a feasible solution,
that is $v \in N$, as \textit{terminals}, vertices which are not terminals as \textit{non-terminals},
and vertices which are not required to be part of a solution but are so anyway, that is
$v \in E_T \cap (V \setminus N)$, as \textit{Steiner vertices}.

Furthermore, let $S \subset V$ define a cut in $G$. If we have $S \cap N \neq \emptyset$ and $(V \setminus S) \cap \emptyset$ then we
 call $S$ a \textit{Steiner cut}.

When $N = V$, the STP is equivalent to the Minimum Spanning Tree Problen, and when $|N| = 2$ the STP is equivalent to finding the
shortest path between two vertices. However, while these problems both have polynomial-time solutions, the STP is an NP-Hard problem,
 the decision variant being part of Edmund Karp's original 21 NP-Complete problems \citep{karp1972reducibility}.

\begin{figure}[h]\centering
\begin{tikzpicture}[auto, node distance=1.5 cm]
  %Nodes
  \node[terminal] (a) {a};
  \node[steiner] (b) [right=of a] {b};
  \node[steiner] (c) [right=of b] {c};
  \node[terminal] (d) [above =of c] {d};
  \node[steiner] (e) [left=of d] {e};
  \node[steiner] (f) [left=of e] {f};
  \node[terminal] (g) [above right=0.75 and 1.3 of c] {g};
  % Edges
  \begin{scope}[every edge/.style={draw=black, thick}]
    \draw (a) edge node[below]{4} (b);
    \draw (b) edge node[near start]{5} (d);
    \draw (b) edge node[below]{8} (c);
    \draw (c) edge node{3} (d);
    \draw (c) edge node{2} (g);
    \draw (c) edge node[near start]{5} (e);
    \draw (d) edge node{6} (e);
    \draw (d) edge node{10} (g);
    \draw (e) edge node{1} (f);
  \end{scope}
\end{tikzpicture}
\caption{Instance of the Steiner Tree Problem. Terminals are coloured black and non-terminals coloured white.}
\label{fig:stp:01}
\end{figure}

Figure (\ref{fig:stp:01}) shows an instance of the STP with three terminals and four Steiner points. Since vertices
A, C, and D are terminals, they must be spanned by any feasible solution. Figure (\ref{fig:stp:01:feasible}) shows
a feasible solution (which we here denote as a set of edges)
$$E_T = \{(a,b), (b,d), (d,g)\}$$
with cost
$$c(T) = 4 + 5 + 10 = 19\mathnormal{.}$$
However, $T$ is not a Steiner tree as there exists at least one feasible solution with lower cost, i.e. the solution
$$E_{T'} = \{(a,b), (b,d), (d,c), (c,g)\}$$
in Figure (\ref{fig:stp:01:min}) which has cost
$$c(T') = 4 + 5 + 3 + 2 = 14\mathnormal{.}$$
% Suboptimal and Optimal STP solutions 
\begin{figure}[h]\centering
  \begin{subfigure}{0.47\linewidth}
    \begin{tikzpicture}[auto, node distance=1.5 cm]
      % Nodes
      \node[terminal] (a) {a};
      \node[steiner] (b) [right=of a] {b};
      \node[steiner] (c) [right=of b] {c};
      \node[terminal] (d) [above =of c] {d};
      \node[steiner] (e) [left=of d] {e};
      \node[steiner] (f) [left=of e] {f};
      \node[terminal] (g) [above right=0.75 and 1.3 of c] {g};
      % Edges
      \begin{scope}[every edge/.style={draw=black, thick}]
        \draw (a) edge[selected] node[below]{4} (b);
        \draw (b) edge[selected] node[near start]{5} (d);
        \draw (b) edge node[below]{8} (c);
        \draw (c) edge node{3} (d);
        \draw (c) edge node{2} (g);
        \draw (c) edge node[near start]{5} (e);
        \draw (d) edge node{6} (e);
        \draw (d) edge[selected] node{10} (g);
        \draw (e) edge node{1} (f);
      \end{scope}
    \end{tikzpicture}
    \caption{Feasible but not optimal.}
    \label{fig:stp:01:feasible}
  \end{subfigure}
  \quad
  \begin{subfigure}{0.47\linewidth}
    \begin{tikzpicture}[auto, node distance=1.5 cm]
      % Nodes
      \node[terminal] (a) {a};
      \node[steiner] (b) [right=of a] {b};
      \node[steiner] (c) [right=of b] {c};
      \node[terminal] (d) [above =of c] {d};
      \node[steiner] (e) [left=of d] {e};
      \node[steiner] (f) [left=of e] {f};
      \node[terminal] (g) [above right=0.75 and 1.3 of c] {g};
      % Edges
      \begin{scope}[every edge/.style={draw=black, thick}]
        \draw (a) edge[selected] node[below]{4} (b);
        \draw (b) edge node[below]{8} (c);
        \draw (b) edge[selected] node[near start]{5} (d);
        \draw (c) edge[selected] node{3} (d);
        \draw (c) edge[selected] node{2} (g);
        \draw (c) edge node[near start]{5} (e);
        \draw (d) edge node{6} (e);
        \draw (d) edge node{10} (g);
        \draw (e) edge node{1} (f);
      \end{scope}
    \end{tikzpicture}

    \caption{Minimal weight, optimal.}
    \label{fig:stp:01:min}
  \end{subfigure}
  \caption{Solutions to the STP in (\ref{fig:stp:01}). Red edges are part of the solution.}
\end{figure} 

\subsection{ILP Formulations}

\paragraph{Cut Formulation} Let $x$ be a decision vector of length $|E|$ where
$x_{ij} = 1$ implies that $(i,j) \in T$ and $x_{ij} = 0$ implies that $(i,j) \not\in T$,
 and let $c$ be a vector of node-weight s.t. $c_{ij} = c((i,j))$.
Then define the function $x : E \to \ZZ$ as
$$x(E') = \sum_{i,j \in E'} x_{ij}$$
that is, $x(E)$ is equal to the number of selected edges in $E$.
Finally let,
$$\delta(S) = \{(i, j) \mid i \in S \wedge j \in (E \setminus S)\}$$
be all edges which span the cut defined by $S$. Then we can formulate
 the STP as in ILP in terms of cuts (see Formulation (\ref{form:stp:cut})).
 \begin{formulation}[h!]
   \begin{subequations}
     \begin{alignat}{3} %TODO: Find reference for this formulation
       &\underset{x}{\text{minimize}}
       & & c^T x & \\
       & \text{subject to}\quad
       & & x(\delta(S)) \geq 1 \qquad&& \forall S \subset V \label{form:stp:cut:cut}\\
       &&&&& S \cap N \neq \emptyset \nonumber\\
       &&&&& S \cap (V \setminus N) \neq \emptyset \nonumber\\
       &&& x \in \BB. &&
     \end{alignat}\label{form:stp:cut}
   \end{subequations}
   \caption{The \textit{Cut Formulation} of the STP \citep{koch1998solving}.}
 \end{formulation}

 Constraints (\ref{form:stp:cut:cut}) ensures that any feasible solution, $T$,  must span all terminals in $G$, by
 requiring that every Steiner cut in $G$ must be crossed by an edge in $T$. This, combined with objective function
  ensures that any optimal solution to (\ref{form:stp:cut}) must be a Steiner tree in $G$ and vice versa.

\section{Steiner Aborescence Problem}
The Steiner Aborescence Problem (SAP) is the directed version of the Steiner Tree Problem.
Given a \textit{directed} graph,
$$G = (V, A, c)$$
a non-empty terminal set $N \subseteq V$, a root terminal $r \in N$, and arc-weights $c : A \to \RR^+$,
then a Steiner Aborescence, $T \subseteq A$, is an aborescence
in $G$, rooted in $r$, which spans $N$ and has minimal cost.

As with the STP, we denote vertices in $N$ as \textit{terminals}, and any non-terminals spanned by a Steiner Aborescence as
 \textit{Steiner vertices} or \textit{Steiner Points}.
\begin{figure}[h]\centering
\begin{tikzpicture}[auto, node distance=1.7 cm]
  %Nodes
  \node[terminal, root] (r) at (0,0) {r};
  \node[steiner] (b) [right= of r] {b};
  \node[terminal] (c) [above= of b] {c};
  \node[steiner] (d) [below= of b] {d};
  \node[steiner] (e) [left= of d] {e};
  \node[terminal] (f) [above right= of d] {f};
  \node[terminal] (g) [above right= of b] {g};
  % Edges
  \begin{scope}[every edge/.style={draw=black, thick}]
    \draw[->] (r) edge [bend left=20] node[above]{4} (b);
    \draw[<-] (r) edge [bend right=20] node[below]{1} (b);
    \draw[->] (r) edge [bend left=20] node[above]{6} (c);
    \draw[->] (r) edge  node{2} (e);
    \draw[->] (b) edge [bend left=20] node{3} (c);
    \draw[<-] (b) edge [bend right=20] node[swap]{2.5} (c);
    \draw[<-] (b) edge  node{3} (d);
    \draw[->] (b) edge  node{5} (f);
    \draw[->] (c) edge [bend left=20] node{3.5} (g);
    \draw[<-] (d) edge  node{1.5} (e);
    \draw[->] (d) edge [bend right] node{2} (f);
    \draw[->] (f) edge node{2} (g);
  \end{scope}
\end{tikzpicture}
\caption{Instance of the Steiner Aborescence Problem. Terminals are coloured black, non-terminals are coloured white, and the root terminal
  has a blue outline.}
\label{fig:sap:01}
\end{figure}

Figure (\ref{fig:sap:01}) shows an instance of the SAP with four terminals. Figure (\ref{fig:sap:01:opt}) shows a Steiner Aborescence in (\ref{fig:sap:01})
with cost $c(T) = 13.5$. It is worth noting that since all arcs must point away from the root in an aborescence, while the path $p = (c, b, r)$  has
 lower cost than the arc $(r, c)$, it cannot be part of a solution. Similarly, solutions to the SAP in the same graph but with root $c$ have lower cost.

\begin{figure}[h]\centering
\begin{tikzpicture}[auto, node distance=1.7 cm]
  %Nodes
  \node[terminal, root] (r) at (0,0) {r};
  \node[steiner] (b) [right= of r] {b};
  \node[terminal] (c) [above= of b] {c};
  \node[steiner] (d) [below= of b] {d};
  \node[steiner] (e) [left= of d] {e};
  \node[terminal] (f) [above right= of d] {f};
  \node[terminal] (g) [above right= of b] {g};
  % Edges
  \begin{scope}[every edge/.style={draw=black, thick}]
    \draw[->] (r) edge [bend left=20] node[above]{4} (b);
    \draw[<-] (r) edge [bend right=20] node[below]{1} (b);
    \draw[->] (r) edge [bend left=20, selected] node[above]{6} (c);
    \draw[->] (r) edge [selected] node{2} (e);
    \draw[->] (b) edge [bend left=20] node{3} (c);
    \draw[<-] (b) edge [bend right=20] node[swap]{2.5} (c);
    \draw[<-] (b) edge  node{3} (d);
    \draw[->] (b) edge  node{5} (f);
    \draw[->] (c) edge [bend left=20] node{3.5} (g);
    \draw[<-] (d) edge [selected, selected] node{1.5} (e);
    \draw[->] (d) edge [bend right, selected] node{2} (f);
    \draw[->] (f) edge [selected] node{2} (g);
  \end{scope}
\end{tikzpicture}
\caption{Steiner Aborescence in (\ref{fig:sap:01}) with cost $13.5$.}
\label{fig:sap:01:opt}
\end{figure}

The SAP is relevant mainly due to a tendency of reformulating the undirected STP into the SAP \citep{koch1998solving}, as well as reformulating
the PCSTP into the SAP \citep{gamrath2017scip, Ljubic:2004:memetic} and
prize-collecting variants of the SAP \citep{leitner2016dual, ljubic2005solving} before stating them as integer programs. This is due to results which show that LP relaxations of
 directed Steiner Tree Problem variants behave better than undirected variants \citep{Chopra:1994}.

\subsection{Reduction from Other Variants}

\subsubsection{Steiner Tree Problem}
\begin{figure}[h]\centering
  \begin{subfigure}{0.47\linewidth}
    \begin{tikzpicture}[auto, node distance=1.5 cm]
      % Nodes
      \node[terminal] (a) {a};
      \node[steiner] (b) [right=of a] {b};
      \node[steiner] (c) [right=of b] {c};
      \node[terminal] (d) [above =of c] {d};
      \node[steiner] (e) [left=of d] {e};
      \node[steiner] (f) [left=of e] {f};
      \node[terminal] (g) [above right=0.75 and 1.3 of c] {g};
      % Edges
      \begin{scope}[every edge/.style={draw=black, thick}]
        \draw (a) edge node[below]{4} (b);
        \draw (b) edge node[near start]{5} (d);
        \draw (b) edge node[below]{8} (c);
        \draw (c) edge node{3} (d);
        \draw (c) edge node{2} (g);
        \draw (c) edge node[near start]{5} (e);
        \draw (d) edge node{6} (e);
        \draw (d) edge node{10} (g);
        \draw (e) edge node{1} (f);
      \end{scope}
    \end{tikzpicture}
    \caption{Problem Instance (\ref{fig:stp:01})}
  \end{subfigure}
  \begin{subfigure}{0.47\linewidth}
    \begin{tikzpicture}[auto, node distance=1.5 cm]
      % Nodes
      \node[terminal] (a) {a};
      \node[steiner] (b) [right=of a] {b};
      \node[steiner] (c) [right=of b] {c};
      \node[terminal, root] (d) [above =of c] {d};
      \node[steiner] (e) [left=of d] {e};
      \node[steiner] (f) [left=of e] {f};
      \node[terminal] (g) [above right=0.75 and 1.3 of c] {g};
      % Edges
      \begin{scope}[every edge/.style={draw=black, thick}]
        \draw[<->] (a) edge node[below]{4} (b);
        \draw[<->] (b) edge node[near start]{5} (d);
        \draw[<->] (b) edge node[below]{8} (c);
        \draw[<->] (c) edge node{3} (d);
        \draw[<->] (c) edge node{2} (g);
        \draw[<->] (c) edge node[near start]{5} (e);
        \draw[<->] (d) edge node{6} (e);
        \draw[<->] (d) edge node{10} (g);
        \draw[<->] (e) edge node{1} (f);
      \end{scope}
    \end{tikzpicture}
    \caption{Instance (\ref{fig:stp:01}) as a SAP instance. Root node is coloured blue.}
  \end{subfigure}
  \caption{Reduction from STP to SAP.}
  \label{fig:stptosap}
\end{figure}

\subsubsection{Prize-Collecting Steiner Tree Problem}

\subsection{ILP Formulations}
\section{Prize-Collecting Steiner Tree Problem}
Given an undirected graph
$$G = (V, E, c, p)$$
where $c: E \to \RR^+$ defines edge weights,
and $p: V \to \RR_0^+$ defines vertex \textit{prizes}, then the solution to the \textit{Prize-Collecting
  Steiner Tree Problem} (PCSTP) is a tree
$$T = (V_T, E_T, c, p) \subseteq G$$
which minimizes
$$c(T) = GW(T) = \sum_{(i,j) \in E_T} c_{ij} + \sum_{v\in (V_T \setminus V)} p_v$$
which is also known as the {\textit{Goemans-Williamson Minimization Problem}}.

The PCSTP can equilvalently be stated as the {\textit{Net Worth Maximization Problem}} \citep{Johnson:2000:PCS:338219.338637},
$$NW(T) = \sum_{v \in V_T} p_v - \sum_{(i,j) \in E_T} c_{ij} \mathnormal{.}$$
In the context of the PCSTP, We denote vertices with nonzero prize as \textit{terminals}, giving the terminal set
$$N = \{v \mid p_v > 0\} \subseteq V\mathnormal{.}$$

\begin{figure}[h]\centering
\begin{tikzpicture}[auto, node distance=1.5 cm]
  %Nodes
  \node[terminal, label={12}] (a) {a};
  \node[steiner] (b) [right=of a] {b};
  \node[steiner] (c) [right=of b] {c};
  \node[terminal, label={10}] (d) [above =of c] {d};
  \node[steiner] (e) [left=of d] {e};
  \node[steiner] (f) [left=of e] {f};
  \node[terminal, label={3}] (g) [above right=0.75 and 1.3 of c] {g};
  % Edges
  \begin{scope}[every edge/.style={draw=black, thick}]
    \draw (a) edge node[below]{4} (b);
    \draw (b) edge node[near start]{5} (d);
    \draw (b) edge node[below]{8} (c);
    \draw (c) edge node{3} (d);
    \draw (c) edge node{2} (g);
    \draw (c) edge node[near start]{5} (e);
    \draw (d) edge node{6} (e);
    \draw (d) edge node{10} (g);
    \draw (e) edge node{1} (f);
  \end{scope}
\end{tikzpicture}
\caption{Instance of the Prize-Collecting Steiner Tree Problem. Terminals are coloured black and non-terminals coloured white.}
\label{fig:pcstp:01}
\end{figure}

Figure (\ref{fig:pcstp:01}) shows an instance, $G$, of the PCSTP created by assigning prizes to the terminals of the STP instance, $G_{STP}$, in Figure (\ref{fig:stp:01}).
Figure (\ref{fig:pcstp:01})
shows an optimal solution, $T = (V_T, E_T)$, to $G$. An interesting observation is that
$T$ is a sub-graph of the solution in Figure (\ref{fig:stp:01:min}) to $G_{STP}$.
In fact, if we were to modify $G_{STP}$ by setting its terminal set to the vertices spanned
by $T$, that is we define $G'_{STP} =  G_{STP}$ where  $N_{G'_{STP}} = V_T$, then $T$ is a Steiner
tree in $G'_{STP}$. In other words, we can describe the search space of the PCSTP
 as the set of all Steiner trees in a graph $G$.

\begin{figure}[h]\centering
\begin{tikzpicture}[auto, node distance=1.5 cm]
  %Nodes
  \node[terminal, label={12}] (a) {a};
  \node[steiner] (b) [right=of a] {b};
  \node[steiner] (c) [right=of b] {c};
  \node[terminal, label={10}] (d) [above =of c] {d};
  \node[steiner] (e) [left=of d] {e};
  \node[steiner] (f) [left=of e] {f};
  \node[terminal, label={3}] (g) [above right=0.75 and 1.3 of c] {g};
  % Edges
  \begin{scope}[every edge/.style={draw=black, thick}]
    \draw (a) edge[selected] node[below]{4} (b);
    \draw (b) edge[selected] node[near start]{5} (d);
    \draw (b) edge node[below]{8} (c);
    \draw (c) edge node{3} (d);
    \draw (c) edge node{2} (g);
    \draw (c) edge node[near start]{5} (e);
    \draw (d) edge node{6} (e);
    \draw (d) edge node{10} (g);
    \draw (e) edge node{1} (f);
  \end{scope}
\end{tikzpicture}
\caption{Optimal solution to (\ref{fig:pcstp:01})\textnormal{.}}
\label{fig:pcstp:01:opt}
\end{figure}

Unsurprisingly, the PCSTP is an NP-Hard problem. It is a generalisation of the STP. Any instance of
the STP with graph $G = (V, E, c)$ and terminal set $N$ can be reduced to an instance of the PCSTP
with graph $G' = (V, E, c, p)$ where
$$p_v =
\begin{cases}
  \infty & v \in N\mathnormal{,} \\
  0 & \mathnormal{otherwise.}
\end{cases}$$
Any optimal solution to $G'$ is then a Steiner tree in $G$ and vice versa.
\subsection{ILP Formulations}
%%% Local Variables:
%%% TeX-master: "report"
%%% reftex-default-bibliography: ("lit.bib")
%%% End:
